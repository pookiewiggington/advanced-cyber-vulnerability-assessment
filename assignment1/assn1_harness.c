#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <fcntl.h>



int main(int argc, char** argv)
{
    //FILE *f = NULL;
    int BYTES = 0;
    //char fname[] = "assn1.0";
    FILE *f = fopen(argv[2], "rb");
    fseek(f, 0L, SEEK_END);
    BYTES = ftell(f);
    fseek(f, 0L, SEEK_SET);
    //f = fopen(argv[2], O_RDONLY);
    char *pheap = malloc(BYTES);
    char pstack[BYTES];
    void (*hfunc)() = pheap;
    void (*sfunc)() = pstack;

    if(strcmp(argv[1],"-h")==0)
    {
        // load assembly and execute in the heap
        fread(pheap, 1, BYTES, f);
        fclose(f);
        hfunc();
        free(pheap);
    }
    else if(strcmp(argv[1],"-s")==0)
    {
        // load assembly and execute in the stack
        
        fread(pstack, 1, BYTES, f);
        fclose(f);
        sfunc();
    }
    else if (argc < 2) 
    {
        printf("Please enter either -h or -s as an option followed by the filename to load");
    }



    return 0;
}